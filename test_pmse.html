<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thom Benjamin Volker">
<meta name="dcterms.date" content="2023-02-05">

<title>Can the pMSE detect missing relationships between variables?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="test_pmse_files/libs/clipboard/clipboard.min.js"></script>
<script src="test_pmse_files/libs/quarto-html/quarto.js"></script>
<script src="test_pmse_files/libs/quarto-html/popper.min.js"></script>
<script src="test_pmse_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="test_pmse_files/libs/quarto-html/anchor.min.js"></script>
<link href="test_pmse_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="test_pmse_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="test_pmse_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="test_pmse_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="test_pmse_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="test_pmse_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="test_pmse_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Can the <span class="math inline">\(pMSE\)</span> detect missing relationships between variables?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thom Benjamin Volker </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>The answer is: Yes, but only if the <span class="math inline">\(pMSE\)</span> model is well-specified, which increases the burden on behalf of the user.</p>
<section id="properties-pmse-for-cart-logistic-regression-and-lasso-regression" class="level1">
<h1>Properties <span class="math inline">\(pMSE\)</span> for CART, logistic regression and lasso regression</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(synthpop)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lfda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="generate-data" class="level2">
<h2 class="anchored" data-anchor-id="generate-data">Generate data</h2>
<section id="three-predictor-variables" class="level3">
<h3 class="anchored" data-anchor-id="three-predictor-variables">Three predictor variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>M3 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, P3)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>SR3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(r, P3, P3)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(SR3) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>SS3 <span class="ot">&lt;-</span> <span class="fu">diag</span>(P3)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>XR3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>P3) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(N, P3) <span class="sc">%*%</span> <span class="fu">chol</span>(SR3)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>XS3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>P3) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(N, P3) <span class="sc">%*%</span> <span class="fu">chol</span>(SS3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ten-predictor-variables" class="level3">
<h3 class="anchored" data-anchor-id="ten-predictor-variables">Ten predictor variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>P10 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>M10 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, P10)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>SR10 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(r, P10, P10)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(SR10) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>SS10 <span class="ot">&lt;-</span> <span class="fu">diag</span>(P10)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>XR10 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>P10) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(N, P10) <span class="sc">%*%</span> <span class="fu">chol</span>(SR10)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>XS10 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>P10) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(N, P10) <span class="sc">%*%</span> <span class="fu">chol</span>(SS10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="twenty-predictor-variables" class="level3">
<h3 class="anchored" data-anchor-id="twenty-predictor-variables">Twenty predictor variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>P20 <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>M20 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, P20)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>SR20 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(r, P20, P20)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(SR20) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>SS20 <span class="ot">&lt;-</span> <span class="fu">diag</span>(P20)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>XR20 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>P20) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(N, P20) <span class="sc">%*%</span> <span class="fu">chol</span>(SR20)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>XS20 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>P20) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(N, P20) <span class="sc">%*%</span> <span class="fu">chol</span>(SS20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combine-data-sets" class="level3">
<h3 class="anchored" data-anchor-id="combine-data-sets">Combine data sets</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>XR <span class="ot">&lt;-</span> <span class="fu">list</span>(XR3, XR10, XR20)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>XS <span class="ot">&lt;-</span> <span class="fu">list</span>(XS3, XS10, XS20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="compare-real-and-synthetic-data" class="level2">
<h2 class="anchored" data-anchor-id="compare-real-and-synthetic-data">Compare real and synthetic data</h2>
<div class="cell" data-hash="test_pmse_cache/html/unnamed-chunk-6_1e82630f1e241ae42d06d70b1b963388">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>CART <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(XR, XS,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">~</span>synthpop<span class="sc">::</span><span class="fu">utility.gen</span>(<span class="fu">data.frame</span>(.x),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">data.frame</span>(.y),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">method =</span> <span class="st">"cart"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">print.flag=</span>F)<span class="sc">$</span>S_pMSE)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(XR, XS,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">~</span>synthpop<span class="sc">::</span><span class="fu">utility.gen</span>(<span class="fu">data.frame</span>(.x),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">data.frame</span>(.y),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">method =</span> <span class="st">"logit"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">print.flag=</span>F,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">maxorder =</span> <span class="dv">1</span>)<span class="sc">$</span>S_pMSE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You will be fitting a large model with  211  parameters and only  500  records
that may take a long time and fail to converge.
Have you selected variables with vars?</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(XR, XS,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                    form <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Synthetic ~ .^3 + "</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste0</span>(<span class="st">"I(X"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(real), <span class="st">"^2)"</span>, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">" + "</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste0</span>(<span class="st">"I(X"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(real), <span class="st">"^3)"</span>, <span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                    dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="at">Real =</span> <span class="fu">data.frame</span>(real),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Synthetic =</span> <span class="fu">data.frame</span>(synthetic),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">.id =</span> <span class="st">"Synthetic"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                    X   <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="fu">as.formula</span>(form), dat)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                    Y   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>Synthetic)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                    mod <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                    p   <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newx =</span> X, <span class="at">s =</span> mod<span class="sc">$</span>lambda.min, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mean</span>((p<span class="fl">-0.5</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> ((<span class="fu">ncol</span>(X))<span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">3</span><span class="sc">/</span><span class="fu">nrow</span>(X))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                  })</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">CART =</span> CART,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">Logistic =</span> logistic,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">Lasso =</span> lasso) <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> CART </th>
   <th style="text-align:right;"> Logistic </th>
   <th style="text-align:right;"> Lasso </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 2.367334 </td>
   <td style="text-align:right;"> 36.31075 </td>
   <td style="text-align:right;"> 21.3709364 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2.519016 </td>
   <td style="text-align:right;"> 11.44123 </td>
   <td style="text-align:right;"> 3.7447982 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2.462893 </td>
   <td style="text-align:right;"> 5.23619 </td>
   <td style="text-align:right;"> 0.8480817 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>So, we can conclude that the <span class="math inline">\(pMSE\)</span> is not very good at detecting missed relationships between variables, and the problem gets worse when the dimensionality of the data increases. Note that the estimates of the lasso are conservative, as the number of variables in the predictor matrix is chosen to be the number of parameters in the model (and thus shrinkage is not accounted for). Using a (probably) overly optimistic estimate (only the non-zero coefficients), the standardized <span class="math inline">\(pMSE\)</span> would be around <span class="math inline">\(7\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(XR, XS, <span class="sc">~</span><span class="fu">utility.tables</span>(<span class="fu">data.frame</span>(.x), <span class="fu">data.frame</span>(.y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

Two-way utility: S_pMSE value plotted for 3 pairs of variables.

Variable combinations with worst 3 utility scores (S_pMSE):
2.X2:3.X3 1.X1:3.X3 1.X1:2.X2 
   7.2140    6.5666    4.5826 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="test_pmse_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Medians and maxima of selected utility measures for all tables compared
       Medians  Maxima
pMSE    0.0197  0.0216
S_pMSE  6.5666  7.2140
df     24.0000 24.0000

For more details of all scores use print.tabs = TRUE.

[[2]]

Two-way utility: S_pMSE value plotted for 45 pairs of variables.

Variable combinations with worst 5 utility scores (S_pMSE):
02.X2:03.X3 01.X1:08.X8 06.X6:07.X7 06.X6:09.X9 01.X1:06.X6 
     9.2868      8.7732      8.1683      8.1605      8.0266 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="test_pmse_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Medians and maxima of selected utility measures for all tables compared
       Medians  Maxima
pMSE    0.0196  0.0279
S_pMSE  6.5431  9.2868
df     24.0000 24.0000

For more details of all scores use print.tabs = TRUE.

[[3]]

Two-way utility: S_pMSE value plotted for 190 pairs of variables.

Variable combinations with worst 5 utility scores (S_pMSE):
  01.X1:06.X6 10.X10:12.X12  06.X6:10.X10  07.X7:18.X18 13.X13:20.X20 
      10.5229        9.8592        9.6286        9.1604        8.9764 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="test_pmse_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Medians and maxima of selected utility measures for all tables compared
       Medians  Maxima
pMSE    0.0194  0.0316
S_pMSE  6.4558 10.5229
df     24.0000 24.0000

For more details of all scores use print.tabs = TRUE.</code></pre>
</div>
</div>
<p>According to the figures, the same findings hold for two-way assessments of utility (i.e., for pairs of variables).</p>
</section>
</section>
<section id="distributional-similarity-after-dimension-reduction" class="level1">
<h1>Distributional similarity after dimension reduction</h1>
<section id="principal-component-analysis" class="level2">
<h2 class="anchored" data-anchor-id="principal-component-analysis">Principal component analysis</h2>
<section id="kolmogorov-smirnov-test-after-pca" class="level3">
<h3 class="anchored" data-anchor-id="kolmogorov-smirnov-test-after-pca">Kolmogorov-Smirnov test after PCA</h3>
<p>Using the Kolmogorov-Smirnov test, we assess the distributional similarity of the real and synthetic data on the first principal component.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  X   <span class="ot">&lt;-</span> <span class="fu">rbind</span>(real, synthetic) <span class="sc">|&gt;</span> <span class="fu">scale</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  USV <span class="ot">&lt;-</span> <span class="fu">svd</span>(X)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  ID  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Real"</span>, <span class="st">"Synthetic"</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(real), <span class="fu">nrow</span>(synthetic)))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(X <span class="sc">%*%</span> USV<span class="sc">$</span>v, ID) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(USV<span class="sc">$</span>v)), <span class="st">"Synthetic"</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(XR, XS, <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>       <span class="fu">pca</span>(real, synthetic) <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2, <span class="at">col =</span> Synthetic)) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_minimal</span>()</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>     }) <span class="sc">|&gt;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="test_pmse_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(XR, XS, <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">pca</span>(real, synthetic)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ks.test</span>(D <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Real"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(PC1),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>          D <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Synthetic"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(PC1))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

    Asymptotic two-sample Kolmogorov-Smirnov test

data:  pull(filter(D, Synthetic == "Real"), PC1) and pull(filter(D, Synthetic == "Synthetic"), PC1)
D = 0.092, p-value = 0.02905
alternative hypothesis: two-sided


[[2]]

    Asymptotic two-sample Kolmogorov-Smirnov test

data:  pull(filter(D, Synthetic == "Real"), PC1) and pull(filter(D, Synthetic == "Synthetic"), PC1)
D = 0.218, p-value = 9.579e-11
alternative hypothesis: two-sided


[[3]]

    Asymptotic two-sample Kolmogorov-Smirnov test

data:  pull(filter(D, Synthetic == "Real"), PC1) and pull(filter(D, Synthetic == "Synthetic"), PC1)
D = 0.276, p-value &lt; 2.2e-16
alternative hypothesis: two-sided</code></pre>
</div>
</div>
</section>
<section id="pmse-after-pca" class="level3">
<h3 class="anchored" data-anchor-id="pmse-after-pca"><span class="math inline">\(pMSE\)</span> after PCA</h3>
<p>A similar result can be obtained by calculating the <span class="math inline">\(pMSE\)</span> using the first-order interactions (including squared terms) for the first two principal components. A similar result here implies a <span class="math inline">\(pMSE\)</span> that also indicates model misfit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(XR, XS, <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  PC <span class="ot">&lt;-</span> <span class="fu">pca</span>(real, synthetic)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> PC <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Real"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> PC <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Synthetic"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  Synthpop_S_pMSE <span class="ot">&lt;-</span> <span class="fu">utility.gen</span>(R <span class="sc">|&gt;</span> <span class="fu">select</span>(PC1, PC2),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                                 S <span class="sc">|&gt;</span> <span class="fu">select</span>(PC1, PC2),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">method =</span> <span class="st">"logit"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">maxorder =</span> <span class="dv">1</span>)<span class="sc">$</span>S_pMSE</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  S_prop <span class="ot">&lt;-</span> <span class="fu">nrow</span>(S) <span class="sc">/</span> <span class="fu">nrow</span>(PC)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  n_pMSE <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> S_prop)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> S_prop <span class="sc">/</span> <span class="fu">nrow</span>(PC)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  Manual_S_pMSE <span class="ot">&lt;-</span> PC <span class="sc">|&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(PC1, PC2, Synthetic) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glm</span>(<span class="at">formula =</span> <span class="fu">factor</span>(Synthetic) <span class="sc">~</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC1<span class="sc">:</span>PC2 <span class="sc">+</span> <span class="fu">I</span>(PC1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(PC2<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> binomial) <span class="sc">|&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(<span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    {\(x) <span class="fu">mean</span>((x<span class="sc">-</span>S_prop)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> n_pMSE}()</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">Synthpop =</span> Synthpop_S_pMSE,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Manual =</span> Manual_S_pMSE)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 Synthpop    Manual 
 5.026017 38.050036 

[[2]]
   Synthpop      Manual 
  0.2247709 108.9874558 

[[3]]
   Synthpop      Manual 
  0.6108608 145.3904673 </code></pre>
</div>
</div>
<p>We see a clear discrepancy between the real and synthetic data in the figure, that is also reflected in the discrepancy score of the Kolmogorov-Smirnov test, but not in the logistic regression model (admittedly with only first order interaction terms and without squared terms, because that is not allowed by the software). If we include these terms, we find a very large standardized <span class="math inline">\(pMSE\)</span> value.</p>
<p>Of course, this finding makes sense, as we see that values that score high on the first principal component (in an absolute sense, so the values in the tails of the distribution) are more likely to be “real” values, whereas values that score high on the second principal component (in an absolute sense, again the values in the tails of the distribution) are much more likely to be synthetic records. However, this will only show up when considering the squared (or absolute) terms, because the centers of the distribution are at the same location for the real and synthetic data.</p>
</section>
</section>
<section id="local-fisher-discriminant-analysis" class="level2">
<h2 class="anchored" data-anchor-id="local-fisher-discriminant-analysis">Local Fisher discriminant analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(XR, XS, <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rbind</span>(real, synthetic)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Real"</span>, <span class="st">"Synthetic"</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(real), <span class="fu">nrow</span>(synthetic)))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">&lt;-</span> <span class="fu">lfda</span>(X, Y, <span class="at">r =</span> <span class="fu">ncol</span>(X), <span class="at">metric =</span> <span class="st">"orthonormalized"</span>)<span class="sc">$</span>Z <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">paste0</span>(<span class="st">"D"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(real)))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  Z <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> D1, <span class="at">y =</span> D2, <span class="at">col =</span> Y)) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">guides =</span> <span class="st">'collect'</span>) <span class="sc">&amp;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="test_pmse_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>First, note that in this situation LFDA gives a result that is highly similar to the result obtained with PCA. That is, the first two components (or dimensions) separate the observed and synthetic samples quite clearly.</p>
<section id="kolmogorov-smirnov-test-after-lfda" class="level3">
<h3 class="anchored" data-anchor-id="kolmogorov-smirnov-test-after-lfda">Kolmogorov-Smirnov test after LFDA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>out_lfda <span class="ot">&lt;-</span> <span class="fu">map2</span>(XR, XS, <span class="cf">function</span>(real, synthetic) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rbind</span>(real, synthetic)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Real"</span>, <span class="st">"Synthetic"</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(real), <span class="fu">nrow</span>(synthetic)))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lfda</span>(X, Y, <span class="at">r =</span> <span class="fu">ncol</span>(X), <span class="at">metric =</span> <span class="st">"orthonormalized"</span>)<span class="sc">$</span>Z <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">paste0</span>(<span class="st">"D"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(X))) <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Synthetic =</span> <span class="fu">factor</span>(Y))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(out_lfda, <span class="cf">function</span>(x) {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Real"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(D1)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Synthetic"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(D1)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ks.test</span>(R, S)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

    Asymptotic two-sample Kolmogorov-Smirnov test

data:  R and S
D = 0.086, p-value = 0.04955
alternative hypothesis: two-sided


[[2]]

    Asymptotic two-sample Kolmogorov-Smirnov test

data:  R and S
D = 0.224, p-value = 2.544e-11
alternative hypothesis: two-sided


[[3]]

    Asymptotic two-sample Kolmogorov-Smirnov test

data:  R and S
D = 0.276, p-value &lt; 2.2e-16
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>The result is very similar to the result of the K-S test after PCA, that is, there is quite a mismatch between the real and synthetic data.</p>
</section>
<section id="pmse-after-lfda" class="level3">
<h3 class="anchored" data-anchor-id="pmse-after-lfda"><span class="math inline">\(pMSE\)</span> after LFDA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(out_lfda, <span class="cf">function</span>(x) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Real"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(D1, D2)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">filter</span>(Synthetic <span class="sc">==</span> <span class="st">"Synthetic"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(D1, D2)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  Synthpop_S_pMSE <span class="ot">&lt;-</span> <span class="fu">utility.gen</span>(R, S,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">method =</span> <span class="st">"logit"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">maxorder =</span> <span class="dv">1</span>)<span class="sc">$</span>S_pMSE</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  S_prop <span class="ot">&lt;-</span> <span class="fu">nrow</span>(S) <span class="sc">/</span> (<span class="fu">nrow</span>(S) <span class="sc">+</span> <span class="fu">nrow</span>(R))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  n_pMSE <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> S_prop)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> S_prop <span class="sc">/</span> (<span class="fu">nrow</span>(S) <span class="sc">+</span> <span class="fu">nrow</span>(R))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  Manual_S_pMSE <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(D1, D2, Synthetic) <span class="sc">|&gt;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glm</span>(<span class="at">formula =</span> <span class="fu">factor</span>(Synthetic) <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> D1<span class="sc">:</span>D2 <span class="sc">+</span> <span class="fu">I</span>(D1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(D2<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> binomial) <span class="sc">|&gt;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(<span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    {\(x) <span class="fu">mean</span>((x<span class="sc">-</span>S_prop)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> n_pMSE}()</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">Synthpop =</span> Synthpop_S_pMSE,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Manual =</span> Manual_S_pMSE)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 Synthpop    Manual 
 5.853248 38.788739 

[[2]]
   Synthpop      Manual 
  0.1588704 110.7553509 

[[3]]
  Synthpop     Manual 
  1.335168 143.338559 </code></pre>
</div>
</div>
<p>A similar result holds after calculating the <span class="math inline">\(pMSE\)</span> with all first-order interactions (including squared terms), there is a mismatch between the real and synthetic data. However, this mismatch shows up only after specifying the <span class="math inline">\(pMSE\)</span> model, which is sensitive to its specification.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>If the <span class="math inline">\(pMSE\)</span> model is correctly specified (i.e., when the model is specified such that the discrepancies between the real and synthetic data can be modeled as conditional mean differences), the <span class="math inline">\(pMSE\)</span> works adequately. However, it can be hard to specify this model, and it is certainly an ad hoc measure. Moreover, a non-parametric <code>CART</code> model is also not very good at picking up such discrepancies, leaving it a labor-intensive task to come up with a good evaluation model.</p>
<p>In these instances, the Kolmogorov-Smirnov test provided an easy-to-use alternative that requires little specification, but depends on correctly reducing the dimensionality of the problem in such a way that the two data sets are maximally different on one component. Preferably, this single component is the first component, to only having to test the first component, rather than all <span class="math inline">\(p\)</span> components.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>